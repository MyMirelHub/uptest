apiVersion: kuttl.dev/v1beta1
kind: TestAssert
timeout: {{ .TestCase.Timeout }}
commands:
- command: ${KUBECTL} annotate managed --all upjet.upbound.io/test=true --overwrite
{{- range $resource := .Resources }}
{{- if $resource.HooksDirPath }}
- script: if [ -f {{ $resource.HooksDirPath }}/pre.sh ]; then {{ $resource.HooksDirPath }}/pre.sh; else echo "No pre hook provided..."; fi
{{- end }}
{{- range $condition := $resource.Conditions }}
{{- if $resource.Namespace }}
- command: ${KUBECTL} wait {{ $resource.KindGroup }}/{{ $resource.Name }} --for=condition={{ $condition }} --timeout 10s --namespace {{ $resource.Namespace }}
{{- else }}
- command: ${KUBECTL} wait {{ $resource.KindGroup }}/{{ $resource.Name }} --for=condition={{ $condition }} --timeout 10s
{{- end }}
{{- end }}
{{- if $resource.HooksDirPath }}
- script: if [ -f {{ $resource.HooksDirPath }}/post.sh ]; then {{ $resource.HooksDirPath }}/post.sh; else echo "No post hook provided..."; fi
{{- end }}
{{- end }}
